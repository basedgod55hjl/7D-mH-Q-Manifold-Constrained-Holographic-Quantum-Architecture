// 7D Translated Source
// Generated by 7D Rewrite Engine v1.0
// Sovereignty: ENABLED

cmake_minimum_required(VERSION 3.25)

project(CPP_BRIDGE LANGUAGES CXX)

# Sources
set(CPP_SOURCES
    gguf_loader.cpp
    bindings/rust_ffi.cpp
)

# Build shared library
add_library(cpp_bridge SHARED ${CPP_SOURCES})

target_include_directories(cpp_bridge PUBLIC
    ${CMAKE_CURRENT_SOURCE_DIR}
    ${CMAKE_SOURCE_DIR}/cuda/include
)

target_link_libraries(cpp_bridge
    crystal_kernels
    CUDA::cudart
)

# Link TensorRT if available
if(TENSORRT_LIB)
    target_link_libraries(cpp_bridge ${TENSORRT_LIB})
    target_compile_definitions(cpp_bridge PRIVATE HAVE_TENSORRT)
endif()

set_target_properties(cpp_bridge PROPERTIES
    POSITION_INDEPENDENT_CODE ON
)

# Install
install(TARGETS cpp_bridge
    LIBRARY DESTINATION ${CMAKE_SOURCE_DIR}/lib
    RUNTIME DESTINATION ${CMAKE_SOURCE_DIR}/lib
    ARCHIVE DESTINATION ${CMAKE_SOURCE_DIR}/lib
)
