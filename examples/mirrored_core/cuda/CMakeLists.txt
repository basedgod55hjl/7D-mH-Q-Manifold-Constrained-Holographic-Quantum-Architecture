// 7D Translated Source
// Generated by 7D Rewrite Engine v1.0
// Sovereignty: ENABLED

cmake_minimum_required(VERSION 3.25 FATAL_ERROR)

project(CRYSTAL_KERNELS LANGUAGES CUDA)

# Kernel sources (7D mH-Q core kernels)
set(KERNEL_SOURCES
    kernels/crystal_cortex.cu
    kernels/mhq7d_attention.cu
    kernels/mhq7d_persistent.cu
    kernels/mhq7d_tensor.cu
    kernels/fused_7d_mhq_attention.cu
)

# CUDA architectures (Ampere, Ada Lovelace, Hopper)
set(CMAKE_CUDA_ARCHITECTURES 86 89 90)

# Build shared library
add_library(crystal_kernels SHARED ${KERNEL_SOURCES})

target_include_directories(crystal_kernels PUBLIC
    ${CMAKE_CURRENT_SOURCE_DIR}/include
)

target_link_libraries(crystal_kernels
    CUDA::cudart
    CUDA::cuda_driver
    CUDA::nvrtc
)

set_target_properties(crystal_kernels PROPERTIES
    CUDA_SEPARABLE_COMPILATION ON
    POSITION_INDEPENDENT_CODE ON
)

# Install
install(TARGETS crystal_kernels
    LIBRARY DESTINATION ${CMAKE_SOURCE_DIR}/lib
    RUNTIME DESTINATION ${CMAKE_SOURCE_DIR}/lib
    ARCHIVE DESTINATION ${CMAKE_SOURCE_DIR}/lib
)
